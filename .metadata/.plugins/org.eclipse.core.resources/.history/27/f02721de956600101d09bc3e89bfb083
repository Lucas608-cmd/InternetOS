package cn.org.act.internetos.manage.app;

import java.io.IOException;
import java.io.StringReader;
import java.util.List;

import org.dom4j.Attribute;
import org.dom4j.CDATA;
import org.dom4j.Comment;
import org.dom4j.Document;
import org.dom4j.DocumentException;
import org.dom4j.DocumentHelper;
import org.dom4j.DocumentType;
import org.dom4j.Element;
import org.dom4j.Entity;
import org.dom4j.Namespace;
import org.dom4j.Node;
import org.dom4j.ProcessingInstruction;
import org.dom4j.Text;
import org.dom4j.Visitor;
import org.dom4j.io.SAXReader;
import org.xml.sax.InputSource;


import cn.org.act.internetos.persist.Application;
import cn.org.act.internetos.persist.Pair;
import cn.org.act.internetos.signal.HttpSignalListener;
import cn.org.act.internetos.signal.MatchRule;
import cn.org.act.internetos.signal.Signal;
import cn.org.act.internetos.signal.SignalListener;

public class ConfigParser {
	public static void main(String[] args){
		Parse(new Application("a","a"),"j");
	}
	public static void Parse(
			Application app, String config) {
		config = "<?xml version=\"1.0\" encoding=\"UTF-8\"?> "+
		"<Application>"+
			"<Name>Test</Name>"+
			"<Listeners>"+
				"<HttpListener>"+
						"<Url>http://localhost:8080/DemoApp/listener</Url>"+
						"<MatchRule type=\"urlregex\">"+
							".*/signal/send.*"+
						"</MatchRule>"+
				"</HttpListener>"+
			"</Listeners>"+
		"</Application>";
		
		try {
			
			Document document =DocumentHelper.parseText(config);
			Node name = document.selectSingleNode("/Application/Name");
			app.setName( name.getText() );
			
			List listeners = document.selectNodes("/Application/Listeners");
			
		} catch (DocumentException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
		
		matchListeners.add(
				new HttpSignalListener("http://localhost:8080/DemoApp/listener",
						new MatchRule() {

							@Override
							public boolean match(Signal signal) {
								// TODO Auto-generated method stub
								return true;
							}

						}));

	}
	
	static void constructApp(Application app,Element appElement){
		
	}
}
